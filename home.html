<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="default.css">
	<script src="https://code.jquery.com/jquery-3.7.0.min.js" type="text/javascript"></script>
	<script>
		$(document).ready(function(){
			var votedPosts = {};

			function createPost(pTitle, pContent, pAuthor) {
				var postContainer = $('.post_container');

				var postId = Date.now();

				// Create the post row element
				var postRow = $('<div>', {
					class: 'post row',
					id: postId
				});
				  
				// Create the rating bar element
				var ratingBar = $('<div>', {
					class: 'rating_bar'
				});
				 
				// TODO: votes should only work once per user
				// Create the upvote button
				var upvoteButton = $('<div>', {
					id: 'upvote-' + postId,
					class: 'button upvote',
					text: '⮝'
				});
				  
				// Create the counter element
				var counter = $('<div>', {
					id: 'counter-' + postId,
					class: 'counter',
					text: '0'
				});

				// Create the downvote button
				var downvoteButton = $('<div>', {
					id: 'downvote-' + postId,
					class: 'button downvote',
					text: '⮟'
				});

				ratingBar.append(upvoteButton, counter, downvoteButton);

				// Create the img element
				var img = $('<div>', {
					class: 'img'
				});

				// Create the info element
					var info = $('<div>', {
					class: 'info'
					});

				// TODO: auto generate link for post ids
				// Create the link element
				var link = $('<a>', {
					href: '#'
				});

				// Create the text element
				var text = $('<div>', {
					class: 'text'
				});

				// Create the title element
				var title = $('<div>', {
					class: 'title',
					text: pTitle
				});

				// Create the preview element
				var preview = $('<div>', {
					class: 'preview',
					text: pContent
				});

				text.append(title, preview);

				// TODO: link this to author page when that is implemented
			 	info.append(link.append(text), $('<div>', {
					class: 'author',
					text: pAuthor
				}));

				postRow.append(ratingBar, img, info);

				postContainer.append(postRow);

				upvoteButton.on('click', function() {
					vote(postId, 1);
				});

				downvoteButton.on('click', function() {
					vote(postId, -1);
				});

			};

			function vote(postId, value) {
				var upvoteButton = $('#upvote-' + postId);
				var downvoteButton = $('#downvote-' + postId);
				var currentVote = votedPosts[postId] || 0;

				// Check if the user has already voted on this post
				if (currentVote === value) {
				    // User clicked on the same vote, remove the vote
				    delete votedPosts[postId];
				    value = 0;
				    upvoteButton.removeClass('selected-upvote');
				    downvoteButton.removeClass('selected-downvote');
				} else {
				    votedPosts[postId] = value;
				    if (value == 1) {
				    	upvoteButton.addClass('selected-upvote')
				    	downvoteButton.removeClass('selected-downvote');
				    }
				    else if (value == -1){
				    	upvoteButton.removeClass('selected-upvote');
				    	downvoteButton.addClass('selected-downvote')
				    }
				}

				var counter = $('#counter-' + postId);
				var currentCount = parseInt(counter.text());

				// Calculate the new vote count
				var newCount = currentCount - currentVote + value;

				// Update the vote count
				counter.text(newCount);
			}


			// TODO: Replace pAuthor with one that reads the current user.
			// TODO: link to author profile
			function pPost(pAuthor) {
				var pTitle = $('#pTitle').val();
				var pContent = $('#pContent').val();
				pAuthor = '@' + 'Foo.Bar';

				createPost(pTitle, pContent, pAuthor);
			}

			$('#pSubmit').on('click', pPost);

			// Dummy Posts
			createPost(`Introduction to the Forum`,`Hello everyone! I'm excited to join this forum and connect with fellow members. I'm particularly interested in discussing the latest trends in technology. Looking forward to engaging conversations and learning from all of you. Cheers!`,`@Steeve`);
			createPost(`Movie Recommendations`,`Hey there! I'm a big movie enthusiast and I thought it would be great to share some of my favorite films. Recently, I watched "Inception" and "The Shawshank Redemption," and both blew my mind! What are some of your must-watch movies? Let's start a movie recommendation thread and discover some hidden gems.`,`@DudeMovies`);
			createPost(`Book Club Announcement`,`Calling all book lovers! I'm thrilled to announce the launch of our forum's book club. Our first book for discussion is "The Great Gatsby" by F. Scott Fitzgerald. If you're interested in participating, grab a copy of the book and join us in the dedicated book club thread. Looking forward to lively discussions and hearing your thoughts on this literary classic!`,`@Bookie22`);
			createPost(`Fitness Tips for Beginners`,`Hey everyone! Are you new to the world of fitness and looking for some guidance? As someone who has been on a fitness journey for a while, I'd love to offer some tips and advice for beginners. From setting realistic goals to finding a workout routine that suits you, let's share our experiences and help each other stay motivated on our fitness quests.`,`@JoeSwanson`);
			createPost(`Traveling on a Budget`,`Greetings, fellow adventurers! Traveling doesn't have to break the bank, and I'm here to prove it. Let's discuss budget-friendly destinations, tips for finding cheap flights, and affordable accommodation options. Whether you're a seasoned traveler or planning your first trip, join the conversation and let's explore the world without emptying our wallets.`,`@LoneWanderer`);

		});
	</script>
	<title>ThreadTalk.™ — Speak your mind</title>
</head>
<body>
	<nav>
		<a href="home.html"><div class="logo">ThreadTalk.™</div></a>
		<ul>
			<li><a href="home.html">Home</a></li>
			<li><a href="#">Search</a></li>
			<li><a href="#">My Profile</a></li>
			<li><a href="#">Login</a></li>
		</ul>
	</nav>
	<header>
		<div class="post_form">
			<form>
				<input type="text" name="pTitle" id="pTitle" placeholder="Thread Title">
				<textarea name="pContent" id="pContent" placeholder="Write a Thread"></textarea>
				<input type="button" name="pSubmit" id="pSubmit" value="Post">
			</form>
		</div>
	</header>
	<content>
		<div class="post_container">
		</div>
	</content>
	<footer>Threads™ 2023</footer>
</body>
</html>