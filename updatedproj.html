<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ThreadTalk.™ — Speak your mind</title>
    <link rel="stylesheet" type="text/css" href="default.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" type="text/javascript"></script>
    <script>
        $(document).ready(function(){
            var votedPosts = {};

            function createPost(pTitle, pContent, pAuthor) {
                var postContainer = $('.post_container');

                var postId = Date.now();

                // Create the post row element
                var postRow = $('<div>', {
                    class: 'post row',
                    id: postId
                });
                  
                // Create the rating bar element
                var ratingBar = $('<div>', {
                    class: 'rating_bar'
                });
                 
                // TODO: votes should only work once per user
                // Create the upvote button
                var upvoteButton = $('<div>', {
                    id: 'upvote-' + postId,
                    class: 'button upvote',
                    text: '⮝'
                });
                  
                // Create the counter element
                var counter = $('<div>', {
                    id: 'counter-' + postId,
                    class: 'counter',
                    text: '0'
                });

                // Create the downvote button
                var downvoteButton = $('<div>', {
                    id: 'downvote-' + postId,
                    class: 'button downvote',
                    text: '⮟'
                });

                ratingBar.append(upvoteButton, counter, downvoteButton);

                // Create the img element
                var img = $('<div>', {
                    class: 'img'
                });

                // Create the info element
                var info = $('<div>', {
                    class: 'info'
                });

                // TODO: auto generate link for post ids
                // Create the link element
                var link = $('<a>', {
                    href: '#'
                });

                // Create the text element
                var text = $('<div>', {
                    class: 'text'
                });

                // Create the title element
                var title = $('<div>', {
                    class: 'title',
                    text: pTitle
                });

                // Create the preview element
                var preview = $('<div>', {
                    class: 'preview',
                    text: pContent
                });

                text.append(title, preview);

                // TODO: link this to author profile
                info.append(link.append(text), $('<div>', {
                    class: 'author',
                    text: pAuthor
                }));

                postRow.append(ratingBar, img, info);

                postContainer.append(postRow);

                upvoteButton.on('click', function() {
                    vote(postId, 1);
                });

                downvoteButton.on('click', function() {
                    vote(postId, -1);
                });

            };

            function vote(postId, value) {
                var upvoteButton = $('#upvote-' + postId);
                var downvoteButton = $('#downvote-' + postId);
                var currentVote = votedPosts[postId] || 0;

                // Check if the user has already voted on this post
                if (currentVote === value) {
                    // User clicked on the same vote, remove the vote
                    delete votedPosts[postId];
                    value = 0;
                    upvoteButton.removeClass('selected-upvote');
                    downvoteButton.removeClass('selected-downvote');
                } else {
                    votedPosts[postId] = value;
                    if (value == 1) {
                        upvoteButton.addClass('selected-upvote');
                        downvoteButton.removeClass('selected-downvote');
                    }
                    else if (value == -1){
                        upvoteButton.removeClass('selected-upvote');
                        downvoteButton.addClass('selected-downvote');
                    }
                }

                var counter = $('#counter-' + postId);
                var currentCount = parseInt(counter.text());

                // Calculate the new vote count
                var newCount = currentCount - currentVote + value;

                // Update the vote count
                counter.text(newCount);
            }

            function createCommentElement(comment) {
                var commentItem = $('<li>', {
                    class: 'comment'
                });

                commentItem.append($('<div>', {
                    class: 'content',
                    html: '<strong>' + comment.user + '</strong>: ' + comment.content
                }));

                var actions = $('<div>', {
                    class: 'actions'
                });

                var editButton = $('<button>', {
                    class: 'edit-comment',
                    text: 'Edit'
                });

                var deleteButton = $('<button>', {
                    class: 'delete-comment',
                    text: 'Delete'
                });

                var upvoteButton = $('<button>', {
                    id: 'upvote-' + comment.commentId,
                    class: 'upvote-comment',
                    text: 'Upvote'
                });

                var downvoteButton = $('<button>', {
                    id: 'downvote-' + comment.commentId,
                    class: 'downvote-comment',
                    text: 'Downvote'
                });

                var counter = $('<span>', {
                    id: 'counter-' + comment.commentId,
                    class: 'votes',
                    text: '0'
                 });

                actions.append(editButton, deleteButton, upvoteButton, downvoteButton, counter);
                commentItem.append(actions);

                return commentItem;
            }

            function addCommentsToPost(postId, comments) {
                var postContainer = $('#' + postId);
                var commentList = $('<ul>', {
                    class: 'comments-list'
                });

                comments.forEach(function(comment) {
                    var commentItem = createCommentElement(comment);
                    commentList.append(commentItem);
                });

                postContainer.append(commentList);
            }

            // Create sample posts
            setTimeout(function() {
                createPost(`Introduction to the Forum`, `Hello everyone! I'm excited to join this forum and connect with you all. Cheers!`, `@Steeve`);
            }, 100);

            setTimeout(function() {
                createPost(`Movie Recommendations`, `Hey there! I'm a big movie enthusiast and I thought it would be great to share and discover some hidden gems.`, `@DudeMovies`);
            }, 200);

            setTimeout(function() {
                createPost(`Book Club Announcement`, `Calling all book lovers! I'm thrilled to announce the launch of our forum's book club. Looking forward to hearing your thoughts on this literary classic!`, `@Bookie22`);
            }, 300);

            setTimeout(function() {
                createPost(`Fitness Tips for Beginners`, `Hey everyone! Are you new to the world of fitness and looking for some tips and guidance? Let's share our experiences and help each other stay motivated on our fitness quests.`, `@JoeSwanson`);
            }, 400);

            setTimeout(function() {
                createPost(`Traveling on a Budget`, `Greetings, fellow adventurers! Traveling doesn't have to break the bank, and I'm here to prove it. Let's discuss budget-friendly destinations, tips for saving money, and share our best travel hacks.`, `@Wanderlust`);
            }, 500);

            // Add sample comments
            setTimeout(function() {
                var comments = [
                    {
                        commentId: 1,
                        user: 'UserA',
                        content: 'Great post! Thanks for sharing.'
                    },
                    {
                        commentId: 2,
                        user: 'UserB',
                        content: 'I have a movie recommendation for you!'
                    },
                    {
                        commentId: 3,
                        user: 'UserC',
                        content: 'Looking forward to joining the book club!'
                    }
                ];

                addCommentsToPost(1624233582827, comments);
            }, 600);

            // Form submission
            $('#pSubmit').on('click', function(e) {
                e.preventDefault();
                var pTitle = $('#pTitle').val();
                var pContent = $('#pContent').val();
                var pAuthor = '@CurrentUser';

                createPost(pTitle, pContent, pAuthor);

                // Clear form fields
                $('#pTitle').val('');
                $('#pContent').val('');
            });

        });
    </script>
</head>
<body>
    <nav>
        <a href="home.html"><div class="logo">ThreadTalk.™</div></a>
        <ul>
            <li><a href="home.html">Home</a></li>
            <li><a href="#">Search</a></li>
            <li><a href="#">My Profile</a></li>
            <li><a href="#">Login</a></li>
        </ul>
    </nav>
    <header>
        <div class="post_form">
            <form>
                <input type="text" name="pTitle" id="pTitle" placeholder="Thread Title">
                <textarea name="pContent" id="pContent" placeholder="Write a Thread"></textarea>
                <input type="button" name="pSubmit" id="pSubmit" value="Post">
            </form>
        </div>
    </header>
    <content>
        <div class="post_container">
        </div>
    </content>
    <footer>Threads™ 2023</footer>
</body>
</html>
